<!-- Repository Container -->
<div class="repo-container-wrapper">

  <!-- Repo Header -->
  <div class="repo-header">
    <span class="repo-title">{{ repoName }}</span>
  </div>

  <!-- Main Content Area -->
  <div class="main-content">

    <!-- Invite Collaborators -->
    <div *ngIf="collaborators.length <= 1" class="invite-collab-block">
      <h2>Add collaborators to this repository</h2>
      <p>Search for people using their username or email address.</p>
      <button class="add-btn" (click)="goToAccessControl()">Invite collaborators</button>
    </div>

    <!-- Branch Dropdown -->
    <div class="repo-navigation">
      <div class="branch-dropdown">
        <button class="branch-btn" (click)="toggleBranchList()">
          <img src="assets/code-branch-solid.svg" alt="Branch Icon" width="16" height="16" />
          {{ selectedBranch }}
          <span class="arrow">&#9662;</span>
        </button>
        <ul class="branch-list" *ngIf="showBranchList">
          <li *ngFor="let branch of branches" (click)="selectBranch(branch.name)" class="branch-item">
            <span>{{ branch.name }}</span>
            <span *ngIf="branch.name === 'main'" class="default-badge">default</span>
          </li>
        </ul>
      </div>
    </div>

    <!-- Commit Banner -->
    <div *ngIf="latestCommitBanner" class="commit-banner">
      <div class="commit-left">
        <img [src]="latestCommitBanner.avatarUrl" alt="avatar" class="commit-avatar" />
        <div class="commit-info">
          <strong>{{ latestCommitBanner.author }}</strong>
          <span class="commit-message">{{ latestCommitBanner.message }}</span>
        </div>
      </div>
      <div class="commit-right">
        <code class="commit-sha">{{ latestCommitBanner.sha }}</code>
        <span class="commit-time">{{ latestCommitBanner.time | timeAgo }}</span>
      </div>
    </div>

    <div *ngIf="!isFile" class="file-list-container">
      <div class="file-list">
    
        <!-- Back link shown only if not at root -->
        <div *ngIf="path" class="file-row back-row" (click)="goBack()">
          <div class="file-left">
            <img src="assets/back.png" alt="Back" width="16" height="16" />
          
          </div>
        </div>
    
        <!-- Regular file/folder rows -->
        <div *ngFor="let item of contents" class="file-row" (click)="loadContents(item.path)">
          <div class="file-left">
            <div class="file-icon">
              <span *ngIf="item.type === 'dir'">
                <img src="assets/folder-solid.svg" alt="Folder Icon" width="16" height="16" />
              </span>
              <span *ngIf="item.type === 'file'">
                <img src="assets/file-lines-solid.svg" alt="File Icon" width="16" height="16" />
              </span>
            </div>
            <div class="file-name">{{ item.name }}</div>
          </div>
          <div class="file-commit" *ngIf="item.latestCommit">{{ item.latestCommit }}</div>
        </div>
    
      </div>
    </div>
    

    <!-- File Viewer -->
    <div *ngIf="isFile" class="file-viewer">
      <button class="back-button" (click)="loadContents(path.substring(0, path.lastIndexOf('/')))">â¬… Back</button>
      <h3>{{ path }}</h3>

      <!-- Show image if it's an image -->
      <img *ngIf="isImage" [src]="fileContent" alt="Image preview" style="max-width: 100%; border-radius: 8px;" />

      <!-- Show text if not image -->
      <pre *ngIf="!isImage" class="file-content">{{ fileContent }}</pre>

      <!-- Empty file fallback -->
      <pre *ngIf="fileContent === 'null'" class="file-content">The file is empty.</pre>
    </div>

    <!-- README Display -->
    <div *ngIf="readmeContent && !isFile" class="readme-preview">
      <h3 class="readme-title">README</h3>
      <pre class="readme-box">{{ readmeContent }}</pre>
    </div>
  </div>
</div>
